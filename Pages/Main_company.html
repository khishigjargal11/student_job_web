<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таны зар</title>
    <link rel="stylesheet" href="../Css/style.css">
    <link rel="stylesheet" href="../Css/components.css">
    <script src="../js/data-manager.js"></script>
    <script src="../js/route-guard.js"></script>
    <script src="../data/sampleData.js"></script>
    <script src="../models/Student.js"></script>
    <script src="../models/Company.js"></script>
    <script src="../models/Job.js"></script>
    <script src="../comp/main-header.js" defer></script>
    <script src="../comp/sidebar-component.js" defer></script>
    <script src="../comp/ad-card.js" defer></script>
    <script src="../comp/main-footer.js" defer></script>
    <script>
        // Load company jobs when page loads
        document.addEventListener('DOMContentLoaded', function() {
            DataManager.initializeData();
            loadCompanyJobs();
        });

        function loadCompanyJobs() {
            const currentUser = DataManager.getCurrentUser();
            const jobContainer = document.getElementById('company-jobs');
            
            if (!currentUser || currentUser.type !== 'company') {
                jobContainer.innerHTML = '<p class="no-jobs">Компанийн хэрэглэгч нэвтрэх шаардлагатай</p>';
                return;
            }

            try {
                console.log('Current user:', currentUser);
                const companyJobs = DataManager.getJobsByCompanyId(currentUser.id);
                console.log('Company jobs:', companyJobs);
                console.log('All jobs in storage:', DataManager.getJobs());
                
                if (companyJobs.length === 0) {
                    jobContainer.innerHTML = '<p class="no-jobs">Та одоогоор ажлын зар нэмээгүй байна. <a href="AddNews.html">Зар нэмэх</a></p>';
                    return;
                }

                jobContainer.innerHTML = '';
                companyJobs.forEach((job, index) => {
                    console.log(`Creating ad card ${index} for job:`, job);
                    const adCard = document.createElement('ad-card-box');
                    adCard.setAttribute('job-id', job.id);
                    jobContainer.appendChild(adCard);
                });
            } catch (error) {
                console.error('Error loading company jobs:', error);
                jobContainer.innerHTML = '<p class="no-jobs">Ажил ачаалахад алдаа гарлаа</p>';
            }
        }
    </script>
</head>
<body>

    <!-- ===== Header Component ===== -->
    <main-header></main-header>

    <!-- ===== Main Content ===== -->
    <main class="container">

        <!-- Sidebar Component -->
        <side-bar></side-bar>

        <!-- User Ads -->
        <section class="content">
            <header>
                <h2>Таны зар:</h2>
            </header>

            <div id="company-jobs">
                <!-- Company jobs will be loaded dynamically -->
            </div>

        </section>
    </main>

    <!-- ===== Footer Component ===== -->
    <main-footer></main-footer>

</body>
</html>
